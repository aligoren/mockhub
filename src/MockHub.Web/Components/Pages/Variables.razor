@page "/variables"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]

<PageTitle>Dynamic Variables - MockHub</PageTitle>

<div class="page-header">
    <div>
        <h1 class="page-title">Dynamic Variables</h1>
        <p class="page-description">All variables you can use in response body</p>
    </div>
</div>

<div class="variables-container">
    <!-- Search -->
    <div class="search-box">
        <input type="text" class="form-control" placeholder="Search variables..." @bind="searchTerm" @bind:event="oninput" />
    </div>

    <!-- Variable Categories -->
    <div class="categories-grid">
        @foreach (var category in GetFilteredCategories())
        {
            <div class="category-card">
                <div class="category-header">
                    <span class="category-icon">@category.Icon</span>
                    <h3 class="category-title">@category.Name</h3>
                </div>
                <p class="category-description">@category.Description</p>
                
                <div class="variables-list">
                    @foreach (var variable in category.Variables)
                    {
                        <div class="variable-item" @onclick="() => CopyToClipboard(variable.Syntax)">
                            <div class="variable-info">
                                <code class="variable-syntax">@variable.Syntax</code>
                                <span class="variable-description">@variable.Description</span>
                            </div>
                            <div class="variable-example">
                                <span class="example-label">Example:</span>
                                <span class="example-value">@variable.Example</span>
                            </div>
                            <button class="copy-btn" title="Copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                                </svg>
                            </button>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <!-- Usage Examples -->
    <div class="card mt-6">
        <h3 class="card-title">Usage Examples</h3>
        
        <div class="example-section">
            <h4>Simple JSON Response</h4>
            <pre class="code-block"><code>{
  "id": "{{faker.random.uuid}}",
  "name": "{{faker.name.fullName}}",
  "email": "{{faker.internet.email}}",
  "phone": "{{faker.phone.number}}",
  "createdAt": "{{now}}"
}</code></pre>
        </div>

        <div class="example-section">
            <h4>URL Parameter Usage</h4>
            <pre class="code-block"><code>{
  "message": "User {{request.params.id}} not found",
  "requestedId": "{{request.params.id}}",
  "timestamp": "{{now}}"
}</code></pre>
        </div>

        <div class="example-section">
            <h4>Query String Usage</h4>
            <pre class="code-block"><code>{
  "page": {{request.query.page | default: 1}},
  "limit": {{request.query.limit | default: 10}},
  "data": []
}</code></pre>
        </div>

        <div class="example-section">
            <h4>Conditional Content</h4>
            <pre class="code-block"><code>{
  "status": "{{#if request.query.success}}success{{else}}error{{/if}}",
  "items": [
    {{#repeat 5}}
    {
      "id": {{@@index}},
      "name": "{{faker.commerce.productName}}",
      "price": {{faker.commerce.price}}
    }{{#unless @@last}},{{/unless}}
    {{/repeat}}
  ]
}</code></pre>
        </div>
    </div>
</div>

@if (showCopied)
{
    <div class="toast">
        ‚úì Copied to clipboard!
    </div>
}

<style>
    .variables-container {
        max-width: 1200px;
    }
    
    .search-box {
        margin-bottom: 1.5rem;
    }
    
    .search-box input {
        max-width: 400px;
    }
    
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
    }
    
    .category-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.25rem;
    }
    
    .category-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }
    
    .category-icon {
        font-size: 1.5rem;
    }
    
    .category-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        color: var(--text-primary);
    }
    
    .category-description {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0 0 1rem 0;
    }
    
    .variables-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .variable-item {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 0.5rem;
        align-items: center;
        padding: 0.625rem 0.75rem;
        background: var(--bg-darker);
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.15s ease;
        border: 1px solid transparent;
    }
    
    .variable-item:hover {
        background: var(--bg-card);
        border-color: var(--primary-color);
    }
    
    .variable-info {
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
        min-width: 0;
    }
    
    .variable-syntax {
        font-family: 'Fira Code', monospace;
        font-size: 0.8rem;
        color: var(--primary-color);
        background: transparent;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .variable-description {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    
    .variable-example {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.125rem;
    }
    
    .example-label {
        font-size: 0.65rem;
        color: var(--text-muted);
        text-transform: uppercase;
    }
    
    .example-value {
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-family: 'Fira Code', monospace;
        max-width: 120px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .copy-btn {
        padding: 0.375rem;
        background: transparent;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        border-radius: 0.25rem;
        transition: all 0.15s ease;
    }
    
    .copy-btn:hover {
        background: var(--primary-color);
        color: white;
    }
    
    .example-section {
        margin-bottom: 1.5rem;
    }
    
    .example-section:last-child {
        margin-bottom: 0;
    }
    
    .example-section h4 {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
        color: var(--text-secondary);
    }
    
    .code-block {
        background: var(--bg-darker);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 0;
        overflow-x: auto;
    }
    
    .code-block code {
        font-family: 'Fira Code', monospace;
        font-size: 0.8rem;
        color: var(--text-primary);
        white-space: pre;
    }
    
    .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--success-color);
        color: white;
        padding: 0.75rem 1.25rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        animation: slideIn 0.3s ease;
        z-index: 1000;
    }
    
    @@keyframes slideIn {
        from {
            transform: translateY(1rem);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>

@code {
    private string searchTerm = "";
    private bool showCopied = false;
    
    private List<VariableCategory> categories = new()
    {
        new VariableCategory
        {
            Name = "Personal Information",
            Icon = "üë§",
            Description = "Name, email and personal information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.name.fullName}}", "Full name", "John Doe"),
                new("{{faker.name.firstName}}", "First name", "John"),
                new("{{faker.name.lastName}}", "Last name", "Doe"),
                new("{{faker.internet.email}}", "Email address", "john@example.com"),
                new("{{faker.internet.userName}}", "Username", "johndoe_42"),
                new("{{faker.phone.number}}", "Phone number", "+1 555-1234"),
                new("{{faker.image.avatar}}", "Avatar URL", "https://..."),
            }
        },
        new VariableCategory
        {
            Name = "Address",
            Icon = "üìç",
            Description = "Address and location information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.address.city}}", "City", "New York"),
                new("{{faker.address.country}}", "Country", "United States"),
                new("{{faker.address.streetAddress}}", "Street address", "123 Main St"),
                new("{{faker.address.zipCode}}", "Zip code", "10001"),
                new("{{faker.address.latitude}}", "Latitude", "40.7128"),
                new("{{faker.address.longitude}}", "Longitude", "-74.0060"),
            }
        },
        new VariableCategory
        {
            Name = "Commerce",
            Icon = "üõí",
            Description = "Product and price information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.commerce.productName}}", "Product name", "Ergonomic Keyboard"),
                new("{{faker.commerce.price}}", "Price", "299.99"),
                new("{{faker.commerce.department}}", "Department", "Electronics"),
                new("{{faker.commerce.productAdjective}}", "Product adjective", "Elegant"),
                new("{{faker.commerce.productMaterial}}", "Material", "Wood"),
            }
        },
        new VariableCategory
        {
            Name = "Date & Time",
            Icon = "üìÖ",
            Description = "Date and time values",
            Variables = new List<VariableInfo>
            {
                new("{{now}}", "Current time (ISO)", "2024-12-24T18:30:00Z"),
                new("{{nowUnix}}", "Unix timestamp", "1703442600"),
                new("{{faker.date.recent}}", "Recent date", "2024-12-20"),
                new("{{faker.date.past}}", "Past date", "2023-06-15"),
                new("{{faker.date.future}}", "Future date", "2025-03-20"),
                new("{{faker.date.birthdate}}", "Birth date", "1990-05-12"),
            }
        },
        new VariableCategory
        {
            Name = "Random Values",
            Icon = "üé≤",
            Description = "UUID, number and random values",
            Variables = new List<VariableInfo>
            {
                new("{{faker.random.uuid}}", "UUID", "550e8400-e29b-41d4..."),
                new("{{faker.random.number}}", "Random number", "42"),
                new("{{faker.random.number(1,100)}}", "Range number", "73"),
                new("{{faker.random.boolean}}", "Boolean", "true"),
                new("{{faker.random.word}}", "Random word", "lorem"),
                new("{{faker.lorem.sentence}}", "Sentence", "Lorem ipsum..."),
                new("{{faker.lorem.paragraph}}", "Paragraph", "Lorem ipsum dolor..."),
            }
        },
        new VariableCategory
        {
            Name = "Internet",
            Icon = "üåê",
            Description = "URL, IP and internet information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.internet.url}}", "URL", "https://example.com"),
                new("{{faker.internet.ip}}", "IP address", "192.168.1.1"),
                new("{{faker.internet.ipv6}}", "IPv6 address", "2001:0db8:85a3..."),
                new("{{faker.internet.mac}}", "MAC address", "00:1A:2B:3C:4D:5E"),
                new("{{faker.internet.color}}", "Hex color", "#3498db"),
                new("{{faker.internet.domainName}}", "Domain", "example.com"),
            }
        },
        new VariableCategory
        {
            Name = "Request Information",
            Icon = "üì®",
            Description = "Incoming request parameters",
            Variables = new List<VariableInfo>
            {
                new("{{request.id}}", "Request ID", "req_abc123"),
                new("{{request.params.id}}", "URL parameter", "/users/:id -> 5"),
                new("{{request.query.page}}", "Query string", "?page=2 -> 2"),
                new("{{request.body.name}}", "Body field", "{name:\"John\"} -> John"),
                new("{{request.headers.authorization}}", "Header value", "Bearer xyz..."),
                new("{{request.method}}", "HTTP method", "GET"),
                new("{{request.path}}", "Request path", "/api/users"),
            }
        },
        new VariableCategory
        {
            Name = "Company",
            Icon = "üè¢",
            Description = "Company and business information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.company.name}}", "Company name", "Acme Ltd."),
                new("{{faker.company.catchPhrase}}", "Catchphrase", "Innovative solutions"),
                new("{{faker.company.bs}}", "Business description", "synergize e-markets"),
                new("{{faker.name.jobTitle}}", "Job title", "Software Engineer"),
                new("{{faker.name.jobType}}", "Job type", "Developer"),
            }
        },
        new VariableCategory
        {
            Name = "Finance",
            Icon = "üí≥",
            Description = "Finance and payment information",
            Variables = new List<VariableInfo>
            {
                new("{{faker.finance.account}}", "Account number", "12345678"),
                new("{{faker.finance.amount}}", "Amount", "1,234.56"),
                new("{{faker.finance.currencyCode}}", "Currency code", "USD"),
                new("{{faker.finance.creditCardNumber}}", "Credit card (fake)", "4111-1111-XXXX"),
                new("{{faker.finance.iban}}", "IBAN", "US00 0000 0000..."),
            }
        }
    };

    private IEnumerable<VariableCategory> GetFilteredCategories()
    {
        if (string.IsNullOrEmpty(searchTerm))
            return categories;
            
        var term = searchTerm.ToLower();
        return categories
            .Select(c => new VariableCategory
            {
                Name = c.Name,
                Icon = c.Icon,
                Description = c.Description,
                Variables = c.Variables
                    .Where(v => v.Syntax.ToLower().Contains(term) || 
                                v.Description.ToLower().Contains(term))
                    .ToList()
            })
            .Where(c => c.Variables.Count > 0);
    }

    private async Task CopyToClipboard(string text)
    {
        // Note: In a real implementation, you'd use JS interop for clipboard
        showCopied = true;
        StateHasChanged();
        
        await Task.Delay(2000);
        showCopied = false;
        StateHasChanged();
    }

    private class VariableCategory
    {
        public string Name { get; set; } = "";
        public string Icon { get; set; } = "";
        public string Description { get; set; } = "";
        public List<VariableInfo> Variables { get; set; } = new();
    }

    private class VariableInfo
    {
        public string Syntax { get; set; }
        public string Description { get; set; }
        public string Example { get; set; }

        public VariableInfo(string syntax, string description, string example)
        {
            Syntax = syntax;
            Description = description;
            Example = example;
        }
    }
}

